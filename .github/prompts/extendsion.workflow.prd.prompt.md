# VS Code æ’ä»¶ï¼šç ”å‘å·¥ä½œæµ (Workflow) PRD v3.0

## 1. äº§å“æ¦‚è¿°

### 1.1 æ ¸å¿ƒç†å¿µ

æœ¬æ’ä»¶æ—¨åœ¨å°†ç ”å‘æ ‡å‡†ä½œä¸šç¨‹åº (SOP) ä»£ç åŒ–ã€å¯è§†åŒ–ã€‚é€šè¿‡ VS Code é¢æ¿å¼•å¯¼å¼€å‘è€…å®Œæˆä»â€œéœ€æ±‚åˆå§‹åŒ–â€åˆ°â€œä¸Šçº¿å‘å¸ƒâ€çš„å…¨ç”Ÿå‘½å‘¨æœŸï¼Œå‡å°‘å¯¹ Git å‘½ä»¤è¡ŒåŠå…¶å¤æ‚å‚æ•°çš„è®°å¿†è´Ÿæ‹…ï¼ŒåŒæ—¶ç¡®ä¿ç ”å‘æ•°æ®çš„è§„èŒƒæ€§å’Œå¯è¿½æº¯æ€§ã€‚

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1.  **é…ç½®é©±åŠ¨ (Configuration as Code)**ï¼šæµç¨‹æ­¥éª¤ã€è¡¨å•é¡¹ã€æŒ‰é’®è¡Œä¸ºå‡ç”±é…ç½®æ–‡ä»¶å®šä¹‰ï¼Œå®ç°æµç¨‹ä¸æ’ä»¶ä»£ç è§£è€¦ã€‚
2.  **æ•°æ®è·Ÿéšåˆ†æ”¯ (Branch-Isolation)**ï¼šç ”å‘çŠ¶æ€æ•°æ®å­˜å‚¨äºå½“å‰åˆ†æ”¯çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œéšä»£ç æäº¤ï¼Œæ— éœ€ç»´æŠ¤å…¨å±€åºå¤§çš„çŠ¶æ€æ–‡ä»¶ã€‚
3.  **å¼±åŒ–äººå·¥å¹²é¢„**ï¼šé™¤å†²çªè§£å†³å¤–ï¼Œåˆ†æ”¯åˆ›å»ºã€æ‰“ Tagã€åˆå¹¶ç­‰æ“ä½œå…¨è‡ªåŠ¨åŒ–ï¼›å›é€€ç­‰éæ ‡å‡†æ“ä½œè¿›è¡Œè§†è§‰å¼±åŒ–ã€‚

---

## 2. æŠ€æœ¯æ¶æ„ä¸æ•°æ®åè®®

### 2.1 é…ç½®æ–‡ä»¶ (`workflow.config.json`)

- **ä½ç½®**ï¼šé¡¹ç›®æ ¹ç›®å½• `/workflow.config.json`
- **ä½œç”¨**ï¼šå®šä¹‰ SOP çš„ç»“æ„ï¼ˆæ­¥éª¤ã€è¡¨å•ã€æŒ‰é’®é€»è¾‘ï¼‰ã€‚
- **ç»´æŠ¤è€…**ï¼šTech Lead / æ¶æ„å¸ˆã€‚

### 2.2 çŠ¶æ€æ–‡ä»¶ (`.vscode/workflow-context.json`)

- **ä½ç½®**ï¼šé¡¹ç›®æ ¹ç›®å½• `/.vscode/workflow-context.json`
- **ä½œç”¨**ï¼šè®°å½•**å½“å‰åˆ†æ”¯**çš„æµè½¬çŠ¶æ€ã€è¡¨å•æ•°æ®ã€å†å²è®°å½•ã€‚
- **ç»´æŠ¤ç­–ç•¥**ï¼š
  - **è·Ÿéšåˆ†æ”¯**ï¼šæ¯ä¸ª Feature åˆ†æ”¯ç‹¬ç«‹æ‹¥æœ‰ä¸€ä»½ï¼Œäº’ä¸å¹²æ‰°ã€‚
  - **éšç æäº¤**ï¼šçŠ¶æ€å˜æ›´åï¼Œæ’ä»¶è‡ªåŠ¨å°†å…¶ commit åˆ°å½“å‰åˆ†æ”¯ï¼Œç¡®ä¿å¤šäººåä½œçŠ¶æ€åŒæ­¥ã€‚
  - **è‡ªåŠ¨æ¸…ç†**ï¼šåˆ†æ”¯è¢«åˆ é™¤æ—¶ï¼Œè¯¥æ–‡ä»¶éšä¹‹é”€æ¯ï¼Œä¸å­˜åœ¨æ–‡ä»¶è†¨èƒ€é—®é¢˜ã€‚

---

## 3. è§†å›¾ä¸äº¤äº’é€»è¾‘

æ’ä»¶æ ¹æ®å½“å‰åˆ†æ”¯æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ `workflow-context.json` æˆ–åˆ†æ”¯å‘½åè§„èŒƒï¼Œè‡ªåŠ¨åˆ‡æ¢è§†å›¾ã€‚

### 3.1 è§†å›¾ Aï¼šéå¼€å‘æ¨¡å¼ (åˆå§‹åŒ–è§†å›¾)

**è§¦å‘æ¡ä»¶**ï¼šå½“å‰å¤„äº `master`/`main` æˆ–é Feature åˆ†æ”¯ã€‚

- **ç•Œé¢**ï¼šä¸æ˜¾ç¤ºæ­¥éª¤æ¡ï¼Œä»…å±…ä¸­æ˜¾ç¤ºä¸»æŒ‰é’®ã€‚
- **ä¸»æŒ‰é’®**ï¼šâ€œğŸš€ å¼€å§‹æ–°çš„ç ”å‘å‘¨æœŸâ€
- **äº¤äº’**ï¼šç‚¹å‡»åŠ è½½ `workflow.config.json` ä¸­å®šä¹‰çš„ **Step 1 (Init)** é…ç½®ï¼Œæ¸²æŸ“åˆå§‹åŒ–è¡¨å•ã€‚

### 3.2 è§†å›¾ Bï¼šå¼€å‘æ¨¡å¼ (æµè½¬è§†å›¾)

**è§¦å‘æ¡ä»¶**ï¼šå½“å‰å¤„äº Feature åˆ†æ”¯ä¸”æ£€æµ‹åˆ° `workflow-context.json`ã€‚

- **é¡¶éƒ¨ç»„ä»¶**ï¼šæ­¥éª¤æ¡ (Stepper)ï¼Œé«˜äº®å½“å‰æ­¥éª¤ï¼Œå·²å®Œæˆæ­¥éª¤æ˜¾ç¤ºæ‰“é’©çŠ¶æ€ã€‚
- **ä¸»ä½“å†…å®¹**ï¼šç”±é…ç½®æ¸²æŸ“çš„åŠ¨æ€è¡¨å•æˆ–ä¿¡æ¯åŒºã€‚
- **åº•éƒ¨æ“ä½œæ **ï¼šç”±é…ç½®æ¸²æŸ“çš„ä¸»æŒ‰é’®å’Œæ¬¡çº§æŒ‰é’®ã€‚

---

## 4. é»˜è®¤æ ‡å‡†å·¥ä½œæµé…ç½®è¯¦è§£

ä»¥ä¸‹å®šä¹‰äº†é»˜è®¤çš„ SOP æµç¨‹ï¼Œæ’ä»¶éœ€å†…ç½®æ­¤é€»è¾‘ä½œä¸º Default Configã€‚

### æ­¥éª¤ä¸€ï¼šéœ€æ±‚åˆå§‹åŒ– (Init)

#### é…ç½®å®šä¹‰

- **ç±»å‹**ï¼šForm (è¡¨å•)
- **è¡¨å•é¡¹**ï¼š
  1.  `meegleId` (Number, å¿…å¡«): éœ€æ±‚ IDã€‚
  2.  `brief` (Text, å¿…å¡«): ä»»åŠ¡ç®€è¿°ï¼ˆä»…é™è‹±æ–‡/æ•°å­—/-ï¼‰ï¼Œç”¨äºç”Ÿæˆåˆ†æ”¯åã€‚
  3.  `prdLink` (URL, å¿…å¡«): PRD åœ°å€ã€‚
  4.  `designLink` (URL, é€‰å¡«): è®¾è®¡ç¨¿åœ°å€ã€‚
  5.  `baseBranch` (Select, é»˜è®¤ master): åŸºäºå“ªä¸ªåˆ†æ”¯åˆ›å»ºã€‚

#### æŒ‰é’®äº¤äº’

- **ä¸»æŒ‰é’®**ï¼šâ€œåˆ›å»º & è¿›å…¥å¼€å‘â€
- **Action**ï¼š`CreateBranch`
- **æ‰§è¡Œé€»è¾‘**ï¼š
  1.  **è„æ£€æŸ¥**ï¼šè‹¥ Git å·¥ä½œåŒºæœ‰æœªæäº¤ä»£ç  -> å¼¹çª—æç¤ºï¼ˆæä¾› Stash æˆ– Reset é€‰é¡¹ï¼‰ã€‚
  2.  **åˆ†æ”¯æ“ä½œ**ï¼š`git fetch` -> `git checkout -b feature/{meegleId}-{brief} origin/{baseBranch}`ã€‚
  3.  **çŠ¶æ€åˆå§‹åŒ–**ï¼šåˆ›å»º `.vscode/workflow-context.json` å†™å…¥è¡¨å•æ•°æ®ï¼Œè®¾ç½® `currentStep = 2`ã€‚
  4.  **è§†å›¾åˆ·æ–°**ï¼šè‡ªåŠ¨è¿›å…¥ç¬¬äºŒæ­¥ã€‚

### æ­¥éª¤äºŒï¼šå¼€å‘é˜¶æ®µ (Development)

#### é…ç½®å®šä¹‰

- **ç±»å‹**ï¼šProcess (æµç¨‹èŠ‚ç‚¹)
- **ä¿¡æ¯å±•ç¤º**ï¼šæ˜¾ç¤º PRD é“¾æ¥ã€è®¾è®¡ç¨¿é“¾æ¥ã€‚

#### æŒ‰é’®äº¤äº’

1.  **åŠŸèƒ½æŒ‰é’®**ï¼šâ€œæäº¤ä»£ç â€ (æ ·å¼: Secondary)
    - **Action**ï¼š`GitCommit` (è°ƒç”¨ yummy commit æˆ– git UI)ã€‚
2.  **ä¸»æŒ‰é’®**ï¼šâ€œå¼€å‘å®Œæˆï¼Œè¿›å…¥æµ‹è¯•â€ (æ ·å¼: Primary)
    - **Action**ï¼š`Transition`
    - **æ‰§è¡Œé€»è¾‘**ï¼š
      - æ ¡éªŒ Git å¹²å‡€çŠ¶æ€ã€‚
      - è‡ªåŠ¨æ‰“ Tag: `test-feature/{id}-{MMDD}-{hhmm}-dev-end`ã€‚
      - æ›´æ–°çŠ¶æ€ `currentStep = 3` å¹¶è‡ªåŠ¨ commit çŠ¶æ€æ–‡ä»¶ã€‚

### æ­¥éª¤ä¸‰ï¼šæµ‹è¯•é˜¶æ®µ (Testing)

#### æŒ‰é’®äº¤äº’

1.  **åŠŸèƒ½æŒ‰é’®**ï¼šâ€œä¿®å¤ Bug & æäº¤â€ (æ ·å¼: Secondary)
    - **Action**ï¼š`GitCommit` (Message å‰ç¼€é¢„è®¾ `fix: `)ã€‚
2.  **å›é€€æŒ‰é’®**ï¼šâ€œå›é€€è‡³å¼€å‘â€ (æ ·å¼: Ghost/Linkï¼Œ**å¼±åŒ–æ˜¾ç¤º**)
    - **Action**ï¼š`Rollback`
    - **äº¤äº’**ï¼šç‚¹å‡»å¼¹å‡º Input æ¡†è¦æ±‚å¡«å†™åŸå›  -> ç¡®è®¤å `currentStep` å˜æ›´ä¸º 2 -> è®°å½•å›é€€æ—¥å¿—ã€‚
3.  **ä¸»æŒ‰é’®**ï¼šâ€œæµ‹è¯•é€šè¿‡ï¼Œè¿›å…¥éªŒæ”¶â€ (æ ·å¼: Primary)
    - **Action**ï¼š`Transition`
    - **Tag æ¨¡æ¿**ï¼š`test-feature/{id}-{MMDD}-{hhmm}-test-pass`ã€‚

### æ­¥éª¤å››ï¼šéªŒæ”¶é˜¶æ®µ (Acceptance)

#### æŒ‰é’®äº¤äº’

1.  **åŠŸèƒ½æŒ‰é’®**ï¼šâ€œéªŒæ”¶ä¿®å¤ & æäº¤â€ (æ ·å¼: Secondary)ã€‚
2.  **å›é€€æŒ‰é’®**ï¼šâ€œéªŒæ”¶ä¸é€šè¿‡â€ (æ ·å¼: Ghost/Linkï¼Œ**å¼±åŒ–æ˜¾ç¤º**)ã€‚
3.  **ä¸»æŒ‰é’®**ï¼šâ€œéªŒæ”¶é€šè¿‡ï¼Œå‡†å¤‡ä¸Šçº¿â€ (æ ·å¼: Primary)
    - **Action**ï¼š`Transition`
    - **Tag æ¨¡æ¿**ï¼š`stage-feature/{id}-{MMDD}-{hhmm}-accepted`ã€‚

### æ­¥éª¤äº”ï¼šä¸Šçº¿é˜¶æ®µ (Release)

#### é…ç½®å®šä¹‰

- **ç±»å‹**ï¼šRelease (å‘å¸ƒèŠ‚ç‚¹)
- **UI ç»„ä»¶**ï¼šRelease åˆ†æ”¯é€‰æ‹©å™¨ (åŠ¨æ€æ‹‰å– `origin/release/*`ï¼ŒæŒ‰ç‰ˆæœ¬å€’åº)ã€‚

#### æŒ‰é’®äº¤äº’

- **ä¸»æŒ‰é’®**ï¼šâ€œåˆå¹¶å¹¶æ¨é€â€ (æ ·å¼: Primary)
- **Action**ï¼š`MergeAndPush`
- **æ‰§è¡Œé€»è¾‘**ï¼š
  1.  **Sync**ï¼š`git fetch` -> `git checkout {releaseBranch}` -> `git pull`ã€‚
  2.  **Merge**ï¼š`git merge feature/{id}-{brief}`ã€‚
  3.  **Conflict Handling**ï¼š
      - **æ— å†²çª** -> `git push` -> æµç¨‹ç»“æŸã€‚
      - **æœ‰å†²çª** -> æŒ‚èµ·æµç¨‹ -> æç¤ºç”¨æˆ·åœ¨ VS Code ä¾§è¾¹æ è§£å†³å†²çª -> æŒ‰é’®å˜ä¸ºâ€œå†²çªå·²è§£å†³ï¼Œç»§ç»­æ¨é€â€ -> ç”¨æˆ·ç‚¹å‡»åæ ¡éªŒå¹¶ Pushã€‚

---

## 5. é…ç½®åŒ–åè®® (Configuration Schema)

ä¸ºäº†å®ç°ä¸Šè¿°æµç¨‹ï¼Œéœ€éµå¾ªä»¥ä¸‹ JSON é…ç½®è§„èŒƒã€‚

### 5.1 `workflow.config.json` ç¤ºä¾‹

```json
{
  "version": "1.0.0",
  "variables": {
    "featurePrefix": "feature/"
  },
  "steps": [
    {
      "id": "init",
      "label": "éœ€æ±‚å¼€å¯",
      "type": "form",
      "fields": [
        {
          "key": "meegleId",
          "label": "Meegle ID",
          "type": "number",
          "required": true
        },
        {
          "key": "brief",
          "label": "ä»»åŠ¡ç®€è¿°",
          "type": "string",
          "pattern": "^[a-z0-9-]+$"
        }
      ],
      "actions": [
        {
          "type": "CreateBranch",
          "label": "åˆ›å»º & ç”Ÿæˆå¼€å‘åˆ†æ”¯",
          "params": {
            "template": "${featurePrefix}${meegleId}-${brief}",
            "nextStep": "dev"
          }
        }
      ]
    },
    {
      "id": "dev",
      "label": "å¼€å‘é˜¶æ®µ",
      "type": "process",
      "display": ["PRD: ${prdLink}"],
      "actions": [
        {
          "type": "GitCommit",
          "label": "æäº¤ä»£ç ",
          "style": "secondary"
        },
        {
          "type": "Transition",
          "label": "å¼€å‘å®Œæˆï¼Œè¿›å…¥æµ‹è¯•",
          "style": "primary",
          "params": {
            "nextStep": "test",
            "tag": "test-feature/${meegleId}-${date}-dev-end"
          }
        }
      ]
    },
    {
      "id": "test",
      "label": "æµ‹è¯•é˜¶æ®µ",
      "type": "process",
      "actions": [
        {
          "type": "Rollback",
          "label": "å›é€€è‡³å¼€å‘",
          "style": "ghost",
          "params": { "targetStep": "dev", "requireReason": true }
        },
        {
          "type": "Transition",
          "label": "æµ‹è¯•é€šè¿‡",
          "style": "primary",
          "params": { "nextStep": "acceptance" }
        }
      ]
    }
    // ... å…¶ä»–æ­¥éª¤é…ç½®
  ]
}
```

### 5.2 æ”¯æŒçš„ Action æšä¸¾

| Action Type        | è¯´æ˜                        | å¿…è¦å‚æ•°                        |
| ------------------ | --------------------------- | ------------------------------- |
| **`CreateBranch`** | åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ï¼Œåˆå§‹åŒ– JSON | `template` (åˆ†æ”¯åæ¨¡æ¿)         |
| **`GitCommit`**    | å”¤èµ·æäº¤ç•Œé¢                | `prefix` (å¯é€‰ commit msg å‰ç¼€) |
| **`Transition`**   | æµè½¬åˆ°ä¸‹ä¸€æ­¥ï¼Œæ”¯æŒæ‰“ Tag    | `nextStep`, `tag` (å¯é€‰)        |
| **`Rollback`**     | å›é€€åˆ°ä¸Šä¸€æ­¥ï¼Œæ”¯æŒæ—¥å¿—è®°å½•  | `targetStep`                    |
| **`MergeAndPush`** | å¤æ‚çš„ Release åˆå¹¶æ¨é€é€»è¾‘ | -                               |
| **`GitStash`**     | æš‚å­˜ä»£ç  (ç”¨äºå‰ç½®æ£€æŸ¥)     | -                               |
| **`GitReset`**     | å¼ºåˆ¶é‡ç½® (ç”¨äºå‰ç½®æ£€æŸ¥)     | -                               |

---

## 6. å¼€å‘è§„èŒƒä¸å®¹é”™

1. **åˆ†æ”¯å‘½å**ï¼šå¼ºåˆ¶å°å†™ï¼Œç©ºæ ¼æ›¿æ¢ä¸ºä¸­åˆ’çº¿ã€‚
2. **Tag æ ¼å¼**ï¼šæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–ä¸º `MMDD-hhmm` (å¦‚ 1219-1405)ã€‚
3. **å¼‚å¸¸å¤„ç†**ï¼š

- æ‰€æœ‰ Git ç½‘ç»œæ“ä½œ (Fetch/Push/Pull) å¿…é¡»åŒ…è£¹åœ¨ `try-catch` ä¸­ï¼Œå¤±è´¥æ—¶é€šè¿‡ Toast æç¤ºï¼Œç¦æ­¢é™é»˜å¤±è´¥ã€‚
- æ£€æµ‹åˆ° `git merge` å†²çªæ—¶ï¼Œå¿…é¡»æš‚åœè‡ªåŠ¨æµç¨‹ï¼Œè½¬äº¤æ§åˆ¶æƒç»™ç”¨æˆ·ã€‚

4. **è‡ªèº«çŠ¶æ€ä¿æŠ¤**ï¼šæ’ä»¶åœ¨æ‰§è¡Œ Git æ“ä½œå‰ï¼Œå¿…é¡»å…ˆç¡®ä¿æŒä¹…åŒ–æ–‡ä»¶ `.vscode/workflow-context.json` å·²ä¿å­˜ï¼Œé˜²æ­¢æ’ä»¶å´©æºƒå¯¼è‡´çŠ¶æ€ä¸¢å¤±ã€‚
